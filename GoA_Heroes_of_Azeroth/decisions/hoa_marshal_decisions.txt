# GoA: Heroes of Azeroth - Marshal Active Decisions
# Makes the Marshal (job_marshal) an active gameplay element
# with campaign planning, border fortification, and military doctrines
# influenced by the marshal's WoW class.

decisions = {

	###############################################
	# 1. PLAN CAMPAIGN
	# The marshal devises a military campaign plan,
	# providing combat bonuses for the next war.
	# Outcome depends on marshal's martial skill.
	###############################################
	hoa_marshal_plan_campaign = {
		only_playable = yes
		ai_check_interval = 120

		potential = {
			is_ruler = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			# Must have a marshal
			job_marshal = {
				always = yes
			}
			NOT = { has_character_modifier = hoa_campaign_plan_cooldown }
		}

		allow = {
			war = no
			# Marshal must be skilled enough to plan a campaign
			job_marshal = {
				martial >= 14
			}
			custom_tooltip = {
				text = hoa_marshal_plan_campaign_tooltip
				job_marshal = {
					martial >= 14
				}
			}
		}

		effect = {
			custom_tooltip = { text = hoa_marshal_planning_campaign_tt }
			hidden_tooltip = {
				character_event = { id = hoa_marshal.1 days = 90 }
			}
			add_character_modifier = {
				name = hoa_campaign_plan_cooldown
				duration = 730
				hidden = yes
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { wealth >= 100 }
			}
			modifier = {
				factor = 2
				martial >= 14
			}
			modifier = {
				factor = 1.5
				job_marshal = { martial >= 18 }
			}
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 1.5
				trait = brave
			}
		}
	}

	###############################################
	# 2. FORTIFY BORDERS
	# The marshal oversees the reinforcement of
	# border defenses, boosting fort level and
	# garrison size for 5 years.
	###############################################
	hoa_marshal_fortify_border = {
		only_playable = yes
		ai_check_interval = 365

		potential = {
			is_ruler = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			# Must have a marshal
			job_marshal = {
				always = yes
			}
			NOT = { has_character_modifier = hoa_fortified_borders }
		}

		allow = {
			wealth >= 200
			# Marshal must be competent
			job_marshal = {
				martial >= 12
			}
			custom_tooltip = {
				text = hoa_marshal_fortify_tooltip
				job_marshal = {
					martial >= 12
				}
			}
		}

		effect = {
			wealth = -200
			custom_tooltip = { text = hoa_marshal_fortifying_borders_tt }
			add_character_modifier = {
				name = hoa_fortified_borders
				duration = 1825
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { wealth >= 500 }
			}
			modifier = {
				factor = 2
				any_neighbor_independent_ruler = {
					war = yes
				}
			}
			modifier = {
				factor = 1.5
				job_marshal = { martial >= 16 }
			}
			modifier = {
				factor = 0.5
				NOT = { higher_tier_than = COUNT }
			}
		}
	}

	###############################################
	# 3. MILITARY DOCTRINE
	# An experienced marshal develops a lasting
	# military doctrine for the realm. The doctrine
	# is influenced by the marshal's WoW class,
	# granting different bonuses per class.
	###############################################
	hoa_marshal_military_doctrine = {
		only_playable = yes
		ai_check_interval = 365

		potential = {
			is_ruler = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			# Must have a highly skilled marshal
			job_marshal = {
				martial >= 16
			}
			# Cannot already have any doctrine active
			NOT = { has_character_modifier = hoa_doctrine_warrior }
			NOT = { has_character_modifier = hoa_doctrine_hunter }
			NOT = { has_character_modifier = hoa_doctrine_mage }
			NOT = { has_character_modifier = hoa_doctrine_paladin }
			NOT = { has_character_modifier = hoa_doctrine_rogue }
			NOT = { has_character_modifier = hoa_doctrine_shaman }
			NOT = { has_character_modifier = hoa_doctrine_deathknight }
			NOT = { has_character_modifier = hoa_doctrine_default }
		}

		allow = {
			# Marshal must be veteran (approximated via high martial + age)
			job_marshal = {
				martial >= 16
				age >= 25
			}
			custom_tooltip = {
				text = hoa_marshal_doctrine_tooltip
				job_marshal = {
					martial >= 16
					age >= 25
				}
			}
		}

		effect = {
			custom_tooltip = { text = hoa_marshal_doctrine_effect_tt }
			hidden_tooltip = {
				# Apply class-specific doctrine based on marshal's class
				if = {
					limit = {
						job_marshal = { is_warrior_class_trigger = yes }
					}
					add_character_modifier = {
						name = hoa_doctrine_warrior
						duration = 1825
					}
				}
				if = {
					limit = {
						job_marshal = { is_hunter_class_trigger = yes }
						NOT = { has_character_modifier = hoa_doctrine_warrior }
					}
					add_character_modifier = {
						name = hoa_doctrine_hunter
						duration = 1825
					}
				}
				if = {
					limit = {
						job_marshal = { is_mage_class_trigger = yes }
						NOT = { has_character_modifier = hoa_doctrine_warrior }
						NOT = { has_character_modifier = hoa_doctrine_hunter }
					}
					add_character_modifier = {
						name = hoa_doctrine_mage
						duration = 1825
					}
				}
				if = {
					limit = {
						job_marshal = { is_paladin_class_trigger = yes }
						NOT = { has_character_modifier = hoa_doctrine_warrior }
						NOT = { has_character_modifier = hoa_doctrine_hunter }
						NOT = { has_character_modifier = hoa_doctrine_mage }
					}
					add_character_modifier = {
						name = hoa_doctrine_paladin
						duration = 1825
					}
				}
				if = {
					limit = {
						job_marshal = { is_rogue_class_trigger = yes }
						NOT = { has_character_modifier = hoa_doctrine_warrior }
						NOT = { has_character_modifier = hoa_doctrine_hunter }
						NOT = { has_character_modifier = hoa_doctrine_mage }
						NOT = { has_character_modifier = hoa_doctrine_paladin }
					}
					add_character_modifier = {
						name = hoa_doctrine_rogue
						duration = 1825
					}
				}
				if = {
					limit = {
						job_marshal = { is_shaman_class_trigger = yes }
						NOT = { has_character_modifier = hoa_doctrine_warrior }
						NOT = { has_character_modifier = hoa_doctrine_hunter }
						NOT = { has_character_modifier = hoa_doctrine_mage }
						NOT = { has_character_modifier = hoa_doctrine_paladin }
						NOT = { has_character_modifier = hoa_doctrine_rogue }
					}
					add_character_modifier = {
						name = hoa_doctrine_shaman
						duration = 1825
					}
				}
				if = {
					limit = {
						job_marshal = { is_deathknight_class_trigger = yes }
						NOT = { has_character_modifier = hoa_doctrine_warrior }
						NOT = { has_character_modifier = hoa_doctrine_hunter }
						NOT = { has_character_modifier = hoa_doctrine_mage }
						NOT = { has_character_modifier = hoa_doctrine_paladin }
						NOT = { has_character_modifier = hoa_doctrine_rogue }
						NOT = { has_character_modifier = hoa_doctrine_shaman }
					}
					add_character_modifier = {
						name = hoa_doctrine_deathknight
						duration = 1825
					}
				}
				# Default fallback - no class or unmatched class
				if = {
					limit = {
						NOT = { has_character_modifier = hoa_doctrine_warrior }
						NOT = { has_character_modifier = hoa_doctrine_hunter }
						NOT = { has_character_modifier = hoa_doctrine_mage }
						NOT = { has_character_modifier = hoa_doctrine_paladin }
						NOT = { has_character_modifier = hoa_doctrine_rogue }
						NOT = { has_character_modifier = hoa_doctrine_shaman }
						NOT = { has_character_modifier = hoa_doctrine_deathknight }
					}
					add_character_modifier = {
						name = hoa_doctrine_default
						duration = 1825
					}
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 2
				job_marshal = { martial >= 20 }
			}
			modifier = {
				factor = 1.5
				job_marshal = { has_any_class_trigger = yes }
			}
			modifier = {
				factor = 2
				higher_tier_than = DUKE
			}
		}
	}
}
